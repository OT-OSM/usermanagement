---
# tasks file for user_creation

- name: Configure sudoers file
  template:
    src: sudoers.j2
    dest: /etc/sudoers
    mode: 0440

- name: Check list of groups exists or not / create a list of groups
  group:
    name: "{{ item }}"
    state: present
  with_items: 
    - "{{secondary_groups}}"
    - "{{primary_group}}"

  
- name: Add user 'user1' with 'user1' as primary group and 'group1', 'group2', 'group3' as secondary groups
  user:
    name: "{{ item.name }}"
    group: "{{ primary_group }}"
    groups: "{{secondary_groups}}"
    append: yes
    shell: "{{default_shell}}"
    home: "{{home_dir}}"            
    state: present
    generate_ssh_key: yes
    ssh_key_bits: "{{ssh_key_bits}}"
    ssh_key_file: "{{ssh_key_file}}"
    password: "{{ item.password }}"
  loop: "{{ user_auth_info }}"